#!/bin/sh

config=src/util/config.ml
makefileconfig=share/Makefile.config

libdir="$LIBDIR/why3"
datadir="$DATADIR/why3"
ocamllib="@OCAMLINSTALLLIB@/why3"
localdir="None"

if [ "@enable_relocation@" = "yes" ]; then
    libdir='Filename.concat (Filename.concat (Filename.dirname
        (Filename.dirname Sys.executable_name)) "lib") "why3"'
    datadir='Filename.concat (Filename.concat (Filename.dirname
        (Filename.dirname Sys.executable_name)) "share") "why3"'
    localdir="None"
fi

cat - > $config <<EOF
let version   = "@VERSION@"

let localdir = try Some (Sys.getenv "WHY3_LOCALDIR") with Not_found -> None

let iflocal local ext =
   match localdir with
   | Some s -> Filename.concat s local
   | None -> ext

let libdir    = iflocal "lib" "$libdir"
let datadir   = iflocal "share" "$datadir"
EOF

echo "
OCAMLBEST   = @OCAMLBEST@
BIGINTLIB   = @BIGINTLIB@
MPFRLIB     = @MLMPFR@
INCLUDE     = @BIGINTINCLUDE@ -I \"$ocamllib\"
INCLUDEALL  = @BIGINTINCLUDE@ @ZIPINCLUDE@ @MENHIRINCLUDE@ -I \"$ocamllib\"
" > $makefileconfig

if [ "@enable_relocation@" = "no" ]; then

echo "
BINDIR      = \"$bindir\"
LIBDIR      = \"$libdir\"
DATADIR     = \"$datadir\"
" >> $makefileconfig

fi
